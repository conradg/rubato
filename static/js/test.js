/**
 * Created by ConradG on 12/01/16.
 */

var T1_Bb2 = "/static/assets/test_pitches/male/normal_set_1/Bb2.wav"
var T1_C3  = "/static/assets/test_pitches/male/normal_set_1/C3.wav"
var T1_D3  = "/static/assets/test_pitches/male/normal_set_1/D3.wav"
var T1_E3  = "/static/assets/test_pitches/male/normal_set_1/E3.wav"
var T1_F3  = "/static/assets/test_pitches/male/normal_set_1/F3.wav"
var T1_G3  = "/static/assets/test_pitches/male/normal_set_1/G3.wav"
var T1_A3  = "/static/assets/test_pitches/male/normal_set_1/A3.wav"
var T1_B3  = "/static/assets/test_pitches/male/normal_set_1/B3.wav"
var T1_C4  = "/static/assets/test_pitches/male/normal_set_1/C4.wav"
var T1_D4  = "/static/assets/test_pitches/male/normal_set_1/D4.wav"
var T1_E4  = "/static/assets/test_pitches/male/normal_set_1/E4.wav"
var T1_F4  = "/static/assets/test_pitches/male/normal_set_1/F4.wav"

var T2_C3  = "/static/assets/test_pitches/male/normal_set_2/C3.wav"
var T2_Cs3 = "/static/assets/test_pitches/male/normal_set_2/Cs3.wav"
var T2_D3  = "/static/assets/test_pitches/male/normal_set_2/D3.wav"
var T2_Eb3 = "/static/assets/test_pitches/male/normal_set_2/Eb3.wav"
var T2_E3  = "/static/assets/test_pitches/male/normal_set_2/E3.wav"
var T2_F3  = "/static/assets/test_pitches/male/normal_set_2/F3.wav"
var T2_Fs3 = "/static/assets/test_pitches/male/normal_set_2/Fs3.wav"
var T2_G3  = "/static/assets/test_pitches/male/normal_set_2/G3.wav"
var T2_Ab3 = "/static/assets/test_pitches/male/normal_set_2/Ab3.wav"
var T2_A3  = "/static/assets/test_pitches/male/normal_set_2/A3.wav"
var T2_Bb3 = "/static/assets/test_pitches/male/normal_set_2/Bb3.wav"
var T2_B3  = "/static/assets/test_pitches/male/normal_set_2/B3.wav"
var T2_C4  = "/static/assets/test_pitches/male/normal_set_2/C4.wav"

var TW_E3 = "/static/assets/test_pitches/male/wobbly/E3.wav"
var TW_G3 = "/static/assets/test_pitches/male/wobbly/G3.wav"
var TW_G3_2 = "/static/assets/test_pitches/male/wobbly/G3_2.wav"
var TW_E3_vib = "/static/assets/test_pitches/male/wobbly/E3_vib.wav"
var TW_G3_vib = "/static/assets/test_pitches/male/wobbly/G3_vib.wav"

var DN1_G2  =  "/static/assets/test_pitches/male/david/normal_1/G2.wav"
var DN1_A2  =  "/static/assets/test_pitches/male/david/normal_1/A2.wav"
var DN1_B2  =  "/static/assets/test_pitches/male/david/normal_1/B2.wav"
var DN1_C3  =  "/static/assets/test_pitches/male/david/normal_1/C3.wav"
var DN1_D3  =  "/static/assets/test_pitches/male/david/normal_1/D3.wav"
var DN1_E3  =  "/static/assets/test_pitches/male/david/normal_1/E3.wav"
var DN1_Fs3 =  "/static/assets/test_pitches/male/david/normal_1/Fs3.wav"
var DN1_G3  =  "/static/assets/test_pitches/male/david/normal_1/G3.wav"

var DV1_G2  =  "/static/assets/test_pitches/male/david/vibrato_1/G2.wav"
var DV1_A2  =  "/static/assets/test_pitches/male/david/vibrato_1/A2.wav"
var DV1_B2  =  "/static/assets/test_pitches/male/david/vibrato_1/B2.wav"
var DV1_C3  =  "/static/assets/test_pitches/male/david/vibrato_1/C3.wav"
var DV1_D3  =  "/static/assets/test_pitches/male/david/vibrato_1/D3.wav"
var DV1_E3  =  "/static/assets/test_pitches/male/david/vibrato_1/E3.wav"
var DV1_Fs3 =  "/static/assets/test_pitches/male/david/vibrato_1/Fs3.wav"
var DV1_G3  =  "/static/assets/test_pitches/male/david/vibrato_1/G3.wav"


var H1_C4 = "/static/assets/test_pitches/male/high_set_1/C4.wav"
var H1_Cs4 = "/static/assets/test_pitches/male/high_set_1/Cs4.wav"
var H1_D4 = "/static/assets/test_pitches/male/high_set_1/D4.wav"
var H1_Eb4 = "/static/assets/test_pitches/male/high_set_1/Eb4.wav"
var H1_E4 = "/static/assets/test_pitches/male/high_set_1/E4.wav"
var H1_F4 = "/static/assets/test_pitches/male/high_set_1/F4.wav"
var H1_Fs4 = "/static/assets/test_pitches/male/high_set_1/Fs4.wav"
var H1_G4 = "/static/assets/test_pitches/male/high_set_1/G4.wav"

var P_G2  = "/static/assets/test_pitches/piano/G2.wav"
var P_Ab2 = "/static/assets/test_pitches/piano/Ab2.wav"
var P_A2  = "/static/assets/test_pitches/piano/A2.wav"
var P_Bb2 = "/static/assets/test_pitches/piano/Bb2.wav"
var P_B2  = "/static/assets/test_pitches/piano/B2.wav"
var P_C3  = "/static/assets/test_pitches/piano/C3.wav"
var P_Cs3 = "/static/assets/test_pitches/piano/Cs3.wav"
var P_D3  = "/static/assets/test_pitches/piano/D3.wav"
var P_Eb3 = "/static/assets/test_pitches/piano/Eb3.wav"
var P_E3  = "/static/assets/test_pitches/piano/E3.wav"
var P_F3  = "/static/assets/test_pitches/piano/F3.wav"
var P_Fs3 = "/static/assets/test_pitches/piano/Fs3.wav"
var P_G3  = "/static/assets/test_pitches/piano/G3.wav"
var P_Ab3 = "/static/assets/test_pitches/piano/Ab3.wav"
var P_A3  = "/static/assets/test_pitches/piano/A3.wav"
var P_Bb3 = "/static/assets/test_pitches/piano/Bb3.wav"
var P_B3  = "/static/assets/test_pitches/piano/B3.wav"
var P_C4  = "/static/assets/test_pitches/piano/C4.wav"
var P_Cs4 = "/static/assets/test_pitches/piano/Cs4.wav"
var P_D4  = "/static/assets/test_pitches/piano/D4.wav"
var P_Eb4 = "/static/assets/test_pitches/piano/Eb4.wav"
var P_E4  = "/static/assets/test_pitches/piano/E4.wav"
var P_F4  = "/static/assets/test_pitches/piano/F4.wav"
var P_Fs4 = "/static/assets/test_pitches/piano/Fs4.wav"
var P_G4  = "/static/assets/test_pitches/piano/G4.wav"
var P_Ab4 = "/static/assets/test_pitches/piano/Ab4.wav"
var P_A4  = "/static/assets/test_pitches/piano/A4.wav"
var P_Bb4 = "/static/assets/test_pitches/piano/Bb4.wav"
var P_B4  = "/static/assets/test_pitches/piano/B4.wav"
var P_C5  = "/static/assets/test_pitches/piano/C5.wav"
var P_Cs5 = "/static/assets/test_pitches/piano/Cs5.wav"
var P_D5  = "/static/assets/test_pitches/piano/D5.wav"
var P_Eb5 = "/static/assets/test_pitches/piano/Eb5.wav"
var P_E5  = "/static/assets/test_pitches/piano/E5.wav"
var P_F5  = "/static/assets/test_pitches/piano/F5.wav"
var P_Fs5 = "/static/assets/test_pitches/piano/Fs5.wav"
var P_G5  = "/static/assets/test_pitches/piano/G5.wav"

var sine440 = "/static/assets/test_pitches/sine/440.wav"
var sine430 = "/static/assets/test_pitches/sine/430.wav"
var sine420 = "/static/assets/test_pitches/sine/420.wav"
var sine410 = "/static/assets/test_pitches/sine/410.wav"
var sine400 = "/static/assets/test_pitches/sine/400.wav"

var sine440n = "/static/assets/test_pitches/sine/440n.wav"
var sine430n = "/static/assets/test_pitches/sine/430n.wav"
var sine420n = "/static/assets/test_pitches/sine/420n.wav"
var sine410n = "/static/assets/test_pitches/sine/410n.wav"
var sine400n = "/static/assets/test_pitches/sine/400n.wav"

var sine440nl = "/static/assets/test_pitches/sine/440nl.wav"

var piano1 = [P_G2,P_Ab2,P_A2,P_Bb2,P_B2,P_C3,P_Cs3,P_D3,P_Eb3,P_E3,P_F3,P_Fs3];
var piano2 = [P_G3,P_Ab3,P_A3,P_Bb3,P_B3,P_C4,P_Cs4,P_D4,P_Eb4,P_E4,P_F4,P_Fs4];
var piano3 = [P_G4,P_Ab4,P_A4,P_Bb4,P_B4,P_C5,P_Cs5,P_D5,P_Eb5,P_E5,P_F5,P_Fs5,P_G5];

var piano = piano1.concat(piano2,piano3);

var male_normal_1 = [T1_Bb2,T1_C3,T1_D3,T1_E3,T1_F3,T1_G3,T1_A3,T1_B3,T1_C4,T1_D4,T1_E4,T1_F4];
var male_normal_2 = [T2_C3,T2_Cs3,T2_D3,T2_Eb3,T2_E3,T2_F3,T2_Fs3,T2_G3,T2_Ab3,T2_A3,T2_Bb3,T2_B3,T2_C4];
var male_wobbly = [TW_E3,TW_G3,TW_G3_2,TW_E3_vib,TW_G3_vib];
var david_normal_1 = [DN1_G2,DN1_A2,DN1_B2,DN1_C3,DN1_D3,DN1_E3,DN1_Fs3,DN1_G3];
var david_vibrato_1 = [DV1_G2,DV1_A2,DV1_D3,DV1_E3,DV1_Fs3];
var male_high = [H1_C4, H1_Cs4, H1_D4, H1_Eb4, H1_E4, H1_F4, H1_Fs4, H1_G4]


var normal = male_normal_1.concat(male_normal_2,david_normal_1);
var david = david_normal_1.concat(david_vibrato_1);
var all = normal.concat(male_wobbly, david, male_high);


var testAudioURLs  = [T1_D3];

var numURLs        = testAudioURLs.length;
var expectedValues = new Array(numURLs);
var actualValues   = new Array(numURLs);

var times_to_test = 1;
var iteration = 0;
var test_seconds = new Array(times_to_test);
var test_results = [];
var start_time;
var verbose = true;


function testPitchDetection(){
    for (var i = 0; i<numURLs; i++){
        var x = testAudioURLs[i];
        var start_index = x.lastIndexOf("/")+1;
        var und_index = x.slice(start_index).indexOf("_") + start_index;
        if (und_index == start_index-1){
            var end_index = x.indexOf(".wav")
        } else {
            var end_index = und_index;
        }
        expectedValues[i] = x.slice(start_index,end_index);
        var note = expectedValues[i]
        var sharp = expectedValues[i].indexOf("s")
        if (sharp != - 1 ){
            expectedValues[i] = note[0] + "#" + note[2];
        }
    }
    start_time = new Date().getTime();
    testPitchDetection_h(0);
}

function testPitchDetection_h(i){
    pitchDetect(testAudioURLs[i], function(){
        actualValues[i] = [detected_pitch_s,detected_cents];

        if (i == numURLs-1){
            var correct = 0;
            var results = "";
            for (var j = 0; j < numURLs; j++){
                if (expectedValues[j] == actualValues[j][0]){
                    correct ++;
                } else {
                    results += "WRONG! ";
                }
                var pitch_s = actualValues[j][0];
                var cents = actualValues[j][1];
                results +="Expected: " + expectedValues[j] + " Got: " + pitch_s + " " + cents + " cents" + "\n";
            }
            if (verbose) {
                console.log(results);
                console.log("Percentage correct: " + correct*100/numURLs + "% with " +  numURLs + " test cases");
            }
            var time_taken = (new Date().getTime() - start_time)/1000;
            test_seconds[iteration] = time_taken;
            var result = "Time taken: " + time_taken + " seconds, or " + (time_taken/numURLs) + " seconds per sample"
            console.log(result);
            $("#pitch").text(result);
            //increment iteration and start next test cycle;
            iteration++;
            if (iteration < times_to_test){
                testPitchDetection();
            }
        } else {
            testPitchDetection_h(i+1);
        }
    })
}
