{% extends "base.html" %}

{% load static %}

{% block title %}Interval training{% endblock %}


{% block javascript %}
<script type="text/javascript" src="{% static "js/pitchDetect.js" %}"></script>
<script type="text/javascript" src="{% static "js/Recorderjs-master/recorder.js" %}"> </script>
<script src="{% static "js/MIDI/js/MIDI/AudioDetect.js" %}" type="text/javascript"></script>
<script src="{% static "js/MIDI/js/MIDI/LoadPlugin.js" %}"type="text/javascript"></script>
<script src="{% static "js/MIDI/js/MIDI/Plugin.js" %}"type="text/javascript"></script>
<script src="{% static "js/MIDI/js/MIDI/Player.js" %}"type="text/javascript"></script>
<script src="{% static "js/MIDI/js/Widgets/Loader.js" %}"type="text/javascript"></script>
<script src="{% static "js/MIDI/js/Window/DOMLoader.XMLHttp.js" %}"type="text/javascript"></script>
<script src="{% static "js/MIDI/inc/Base64.js" %}" type="text/javascript"></script>
<script src="{% static "js/MIDI/inc/base64binary.js" %}" type="text/javascript"></script>
<script src="{% static "js/vexflow-master/build/vexflow/vexflow-min.js" %}" type="text/javascript"></script>
{% endblock %}



{% block main %}
    <h1>Test your intonation</h1>
    <div id="debug">
        <h2>Debug</h2>
        <hr/>
        <input onclick="testPitchDetection()" type="button" value="test pitch detection"/>
        <input onclick="sendScore()" type="button" value="send score"/>
        <input onclick="getInterval()" type="button" value="get interval"/>
    </div>
    <div id="main_exercise">
        <h2 id="help">help</h2>
        <div id="pitch" style="display:block;text-align: center">Press play to hear the note</div>
        <div class="container">
            <div id="exercise">
                <div id="interval"><h1 id="interval_text"></h1></div>
                    <div id="buttons">
                        <div class="button-container">
                            <div id="playbutton">
                                <img onclick="playNote();" src="{% static "assets/images/play.png" %}"/>
                            </div>
                        </div><div class="button-container">
                            <div id="recordbutton">
                                <img onclick="toggleRecording()"  src="{% static "assets/images/record.png" %}"/>
                            </div>
                        </div>
                    </div>
            </div><div id="displays" >
                <div class="canvas_display">
                    <h1>Autocorrelation Function</h1>
                    <canvas id="correlation_canvas"></canvas>
                    <div class="debug_info">
                        <ul>
                            <li id="window"></li>
                            <li id="window_pitch"></li>
                        </ul>
                    </div>
                </div>
                <div class="canvas_display">
                    <h1>Frequency</h1>
                    <canvas id="frequency_canvas"></canvas>
                    <div class="debug_info">
                        <ul>
                            <li id="frequency"></li>
                        </ul>
                    </div>
                </div>
                <div class="canvas_display">
                    <h1>Amplitude</h1>
                    <canvas id="amplitude_canvas"></canvas>
                    <div class="debug_info">
                        <ul>
                            <li id="amplitude"></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

    </div>
    <script type="text/javascript">
    if (!debug){
        $("#displays").remove();
    }
    window.onload = function () {

        MIDI.loadPlugin({
            soundfontUrl: "{% static "js/MIDI/soundfont/"  %}",
            instrument: "acoustic_grand_piano",
            callback: function(){
                $("#overlay").fadeOut(400,function(){$("#overlay").remove()});
            }
        });
    };


    var loading = function() {
        // add the overlay with loading image to the page

        var over = '<div id="overlay">' +
            '<img id="loading" src="{% static "assets/images/loading.gif" %}">' +
            '</div>';
        $(over).appendTo('body');
    };

    loading();
    </script>
{% endblock %}